<launch>

  <arg name="robot_ip" />	
  <arg name="report_type" default="normal" />	
  <arg name="ns" default="xarm" />
  <!-- Important: currently real xArm can be either controlled by API service or Moveit planner, but not at the same time! -->
  <!-- If you use moveit, use the launch file in xarm*_moveit_config package for startup! -->
  <arg name="use_moveit" default="false" />
  <arg name="use_gripper_action" default="false" />
  <arg name="velocity_control" default="false"/>

  <rosparam file="$(find xarm6_moveit_config)/config/xarm6_params.yaml" command="load"/>
  <rosparam if="$(arg use_moveit)" file="$(find xarm6_moveit_config)/config/joint_limits.yaml" command="load" ns="$(arg ns)"/>

  <!-- common: bring up node to collect robot feedback -->
  <include file="$(find xarm_bringup)/launch/xarm_driver_common.launch">
    <arg name="robot_ip" value="$(arg robot_ip)" />
    <arg name="report_type" value="$(arg report_type)" />
    <arg name="dof" value="6" />
    <arg name="use_moveit" value="$(arg use_moveit)" />
    <arg name="namespace" value="$(arg ns)" />
    <arg name="velocity_control" value="$(arg velocity_control)" />
  </include>

  <!-- Load the position controllers -->
  <rosparam file="$(find xarm_controller)/config/xarm6_position_controllers.yaml" command="load"/>
  <node unless="$(eval arg('velocity_control'))"
    name="position_controller_spawner"
    pkg="controller_manager"
    type="spawner"
    respawn="false"
    output="screen"
    ns="/$(arg ns)"
    args="--stopped
          joint1_position_controller joint2_position_controller
          joint3_position_controller joint4_position_controller
          joint5_position_controller joint6_position_controller
          "/>

  <!-- Load cartesian controller -->
  <rosparam file="$(find xarm_controller)/config/xarm6_cartesian_controller.yaml" command="load"></rosparam>
  <arg name="xarm_cartesian_motion_controller" value="$(eval 'xarm6_cartesian_motion_controller_velocity' if arg('velocity_control') else 'xarm6_cartesian_motion_controller')" />
  <node name="cartesian_controller_spawner"
    pkg="controller_manager"
    type="spawner"
    respawn="false"
    output="screen"
    ns="$(arg ns)"
    args="--stopped $(arg xarm_cartesian_motion_controller)"/>

  <!-- the node for xarm gripper action server -->
  <node if="$(arg use_gripper_action)"
    name="gripper_action_server"
    pkg="xarm_gripper"
    type="gripper_action_server"
    respawn="false"
    output="screen"
    ns="$(arg ns)"/>

</launch>
